### 0. 회원가입
POST http://localhost:8080/api/v1/auth/signup
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "Test1234!@#",
  "nickName": "Beemo"
}

> {%
  client.global.set("userId", response.body.data.userId);
%}

### 0-1. 로그인(HOST) - accessToken 발급
POST http://localhost:8080/api/v1/auth/login
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "Test1234!@#"
}

> {%
  client.global.set("accessToken", response.body.data.accessToken);
%}

### 0-2. (추가) 삭제 알림 받을 MEMBER 회원가입
POST http://localhost:8080/api/v1/auth/signup
Content-Type: application/json

{
  "email": "delmember@example.com",
  "password": "Test1234!@#",
  "nickName": "DelMember"
}

> {%
  client.global.set("delMemberUserId", response.body.data.userId);
%}

### 0-3. (추가) 삭제 알림 받을 MEMBER 로그인
POST http://localhost:8080/api/v1/auth/login
Content-Type: application/json

{
  "email": "delmember@example.com",
  "password": "Test1234!@#"
}

> {%
  client.global.set("delMemberAccessToken", response.body.data.accessToken);
%}

### (추가) MEMBER SSE 구독 (삭제 이벤트 실시간 수신용)
GET http://localhost:8080/api/v1/notifications/subscribe
Authorization: Bearer {{delMemberAccessToken}}
Accept: text/event-stream
Cache-Control: no-cache
Connection: keep-alive


### 1-1. 모임 V2 이미지 선 업로드 (png / jpg 2장)
POST http://localhost:8080/api/v2/groups/images/upload
Content-Type: multipart/form-data; boundary=boundary
Authorization: Bearer {{accessToken}}

--boundary
Content-Disposition: form-data; name="images"; filename="img1.png"
Content-Type: image/png

< ../../image/resources/img1.png
--boundary
Content-Disposition: form-data; name="images"; filename="img2.jpg"
Content-Type: image/jpeg

< ../../image/resources/img2.jpg
--boundary--

> {%
  const images = response.body.data.images;

  client.global.set("del_img0_key", images[0].imageKey);
  client.global.set("del_img1_key", images[1].imageKey);
%}

### 1-2. 모임 V2 생성 (삭제 테스트용 - imageKey로 생성)
POST http://localhost:8080/api/v2/groups/create
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "모임 삭제 테스트 - 기본 생성",
  "location": "서울 강남구",
  "joinPolicy": "FREE",
  "locationDetail": "강남역 2번 출구 근처 카페",
  "startTime": "2026-12-10T19:00:00",
  "endTime": "2026-12-10T21:00:00",
  "tags": [
    "자바",
    "백엔드",
    "스터디"
  ],
  "description": "삭제 API 테스트를 위해 생성한 모임입니다.",
  "maxParticipants": 12,
  "images": [
    {
      "sortOrder": 0,
      "imageKey": "{{del_img0_key}}"
    },
    {
      "sortOrder": 1,
      "imageKey": "{{del_img1_key}}"
    }
  ]
}

> {%
  client.global.set("groupId_delete", response.body.data.id);
%}

### (추가) MEMBER가 모임 참가 -> GroupUser 생성됨 (삭제 알림 대상 확보)
POST http://localhost:8080/api/v2/groups/{{groupId_delete}}/attend
Authorization: Bearer {{delMemberAccessToken}}
Content-Type: application/json

{}

### 1-3. 모임 V2 단건 조회 (삭제 전 상태 확인)
GET http://localhost:8080/api/v2/groups/{{groupId_delete}}
Authorization: Bearer {{accessToken}}

### 2-0-1. (삭제 직전) MEMBER unread-count
GET http://localhost:8080/api/v1/notifications/unread-count
Authorization: Bearer {{delMemberAccessToken}}

> {%
  client.global.set("beforeUnread", response.body.data);
%}

### 2-0-2. (삭제 직전) MEMBER 알림 목록 조회 (baseline)
GET http://localhost:8080/api/v1/notifications?size=20
Authorization: Bearer {{delMemberAccessToken}}

### 2-1. 모임 V2 삭제 (Hard Delete) - 성공 기대 (204 No Content)
DELETE http://localhost:8080/api/v2/groups/{{groupId_delete}}
Authorization: Bearer {{accessToken}}

### 2-2-1. (삭제 직후) MEMBER unread-count (증가 기대)
GET http://localhost:8080/api/v1/notifications/unread-count
Authorization: Bearer {{delMemberAccessToken}}

> {%
  const afterUnread = response.body.data;
  const beforeUnread = Number(client.global.get("beforeUnread") || 0);

  client.test("unread-count should increase by 1", function() {
    client.assert(afterUnread === beforeUnread + 1, "Expected unread to increase by 1. before=" + beforeUnread + " after=" + afterUnread);
  });
%}

### 2-2-2. (삭제 직후) MEMBER 알림 목록 조회 (GROUP_DELETE 존재 기대)
GET http://localhost:8080/api/v1/notifications?size=20
Authorization: Bearer {{delMemberAccessToken}}

> {%
  const list = response.body.data.result || response.body.data; // 응답 구조에 따라 조정
  const found = list.some(n => n.type === "GROUP_DELETE" || (n.type && n.type.includes("GROUP_DELETE")));

  client.test("notification list contains GROUP_DELETE", function() {
    client.assert(found, "Expected GROUP_DELETE notification in list");
  });
%}

### 2-2. 모임 V2 단건 조회 (삭제 후 조회 → 예외 기대: GROUP_NOT_FOUND_BY_ID)
GET http://localhost:8080/api/v2/groups/{{groupId_delete}}
Authorization: Bearer {{accessToken}}

### 2-3. 모임 V2 재삭제 (이미 삭제된 모임 재요청 → 예외 기대: GROUP_NOT_FOUND_BY_ID)
DELETE http://localhost:8080/api/v2/groups/{{groupId_delete}}
Authorization: Bearer {{accessToken}}

### 3-1. 예외준비: 다른 사용자 회원가입 (MEMBER)
POST http://localhost:8080/api/v1/auth/signup
Content-Type: application/json

{
  "email": "member@example.com",
  "password": "Test1234!@#",
  "nickName": "Finn"
}

> {%
  client.global.set("memberUserId", response.body.data.userId);
%}

### 3-2. 로그인(MEMBER) - accessToken 발급
POST http://localhost:8080/api/v1/auth/login
Content-Type: application/json

{
  "email": "member@example.com",
  "password": "Test1234!@#"
}

> {%
  client.global.set("memberAccessToken", response.body.data.accessToken);
%}

### 3-3. 모임 V2 이미지 선 업로드 (삭제 권한 예외 테스트용)
POST http://localhost:8080/api/v2/groups/images/upload
Content-Type: multipart/form-data; boundary=boundary
Authorization: Bearer {{accessToken}}

--boundary
Content-Disposition: form-data; name="images"; filename="img1.png"
Content-Type: image/png

< ../../image/resources/img1.png
--boundary--

> {%
  const images = response.body.data.images;
  client.global.set("auth_img0_key", images[0].imageKey);
%}

### 3-4. 모임 V2 생성 (삭제 권한 예외 테스트용)
POST http://localhost:8080/api/v2/groups/create
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "모임 삭제 테스트 - 권한 예외",
  "location": "서울 강남구",
  "joinPolicy": "FREE",
  "locationDetail": "강남역 2번 출구 근처 카페",
  "startTime": "2026-12-10T19:00:00",
  "endTime": "2026-12-10T21:00:00",
  "tags": [
    "자바",
    "백엔드"
  ],
  "description": "Memeber가 삭제 시도하면 예외가 떠야 합니다.",
  "maxParticipants": 12,
  "images": [
    {
      "sortOrder": 0,
      "imageKey": "{{auth_img0_key}}"
    }
  ]
}

> {%
  client.global.set("groupId_delete_auth", response.body.data.id);
%}

### 3-5. 모임 V2 참가 (MEMBER가 참가자 생성 → GroupUser 생성됨)
POST http://localhost:8080/api/v2/groups/{{groupId_delete_auth}}/attend
Authorization: Bearer {{memberAccessToken}}

### 3-6. 모임 V2 삭제 시도 (MEMBER) → 예외 기대: GROUP_ONLY_HOST_CAN_UPDATE (또는 DELETE 전용 에러코드)
DELETE http://localhost:8080/api/v2/groups/{{groupId_delete_auth}}
Authorization: Bearer {{memberAccessToken}}

### 3-7. 모임 V2 삭제 (HOST) - 참가자(GroupUser), 태그 연결(GroupTag), 이미지/variants 포함 전체 삭제 기대
DELETE http://localhost:8080/api/v2/groups/{{groupId_delete_auth}}
Authorization: Bearer {{accessToken}}

### 3-8. 모임 V2 단건 조회 (삭제 확인 → 예외 기대: GROUP_NOT_FOUND_BY_ID)
GET http://localhost:8080/api/v2/groups/{{groupId_delete_auth}}
Authorization: Bearer {{accessToken}}

### 4. 예외발생: 존재하지 않는 모임 삭제 → 예외 기대: GROUP_NOT_FOUND_BY_ID
DELETE http://localhost:8080/api/v2/groups/999999999
Authorization: Bearer {{accessToken}}
